<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>AstroTunes App</title>
    <link rel="icon" href="/images/login.png" />
    <link rel="stylesheet" href="css/reset.css" />
    <link rel="stylesheet" href="css/slick.css" />
    <link rel="stylesheet" href="css/jquery.fancybox.css" />
    <link rel="stylesheet" href="css/app.css" />
</head>
<body>
    <header class="app">
        <a class="back-home" href="/index.html">
            <img src="/images/login.png" />
        </a>
        <div class="container">
            <h1>What is your mood?</h1>
            <div class="modes">
                <button class="mode-button" id="energize">Energize</button>
                <button class="mode-button" id="calm">Calm</button>
                <button class="mode-button" id="focus">Focus</button>
                <button class="mode-button" id="sleep">Sleep</button>
                <button class="mode-button" id="happy">Happy</button>
                <button class="mode-button" id="homebound">Homebound</button>
                <button class="mode-button" id="reflective">Reflective</button>
                <button class="mode-button" id="adventure">Adventure</button>
                <button class="mode-button" id="connection">Connection</button>
                <button class="mode-button" id="meditative">Meditative</button>
            </div>
        </div>
    </header>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="js/slick.min.js"></script>
    <script src="js/jquery.fancybox.min.js"></script>
    <script>
        // Function to handle button clicks
        function handleButtonClick(moodId) {
            // Clear the page content
            document.body.innerHTML = '';


            const axios = require("axios");
            const qs = require("qs");
require("dotenv").config();
const client_id = process.env.SPOTIFY_CLIENT_ID; // Your client id
const client_secret = process.env.SPOTIFY_CLIENT_SECRET; // Your secret
const auth_token = Buffer.from(
  `${client_id}:${client_secret}`,
  "utf-8"
).toString("base64");
const getAuth = async () => {
  try {
    //make post request to SPOTIFY API for access token, sending relavent info
    const token_url = "https://accounts.spotify.com/api/token";
    const data = qs.stringify({ grant_type: "client_credentials" });
    const response = await axios.post(token_url, data, {
      headers: {
        Authorization: `Basic ${auth_token}`,
        "Content-Type": "application/x-www-form-urlencoded",
      },
    });
    console.log("ACCESS TOKEN IS: " + response.data.access_token);
    return response.data.access_token;
  } catch (error) {
    //on fail, log the error in console
    console.log(error);
  }
};
async function moodToSongs(mood) {
  const token = await getAuth();
  let seedGenre = "pop";
  let targetEnergy = 0.5;
  let targetValence = 0.5;
  switch (mood) {
    case "happy":
      targetEnergy = 0.8;
      targetValence = 0.9;
      break;
    case "sad":
      targetEnergy = 0.3;
      targetValence = 0.2;
      break;
  }
  try {
    const response = await axios.get(
      "https://api.spotify.com/v1/recommendations",
      {
        headers: {
          Authorization: `Bearer ${token}`,
        },
        params: {
          seed_genres: seedGenre,
          target_energy: targetEnergy,
          target_valence: targetValence,
          limit: 10,
        },
      }
    );
    const json = response.data.tracks;
    let songArr = [];
    json.forEach((json) => {
      const songName = json.name;
      const spotifyLink = json.external_urls.spotify;
      songArr.push([songName, spotifyLink]);
    });
    // console.log(songArr)
    let jsonArray = songArr.map((row) => {
      return {
        name: row[0],
        url: row[1],
      };
    });
    let jsonString = JSON.stringify(jsonArray, null, 2);
    console.log(jsonString);
    return jsonString;
  } catch (error) {
    console.error("NOPE");
  }
}
            let songData = moodToSongs(moodID);

            // Create new content
            const newContent = document.createElement('div');
            newContent.classList.add('new-content');
            newContent.innerHTML = `
                <h2>Selected Mood: ${moodId}</h2>
                <p>We are fetching the best playlists to match your mood!</p>
                <button onclick="goBack()">Choose another mood</button>
            `;

            document.body.appendChild(newContent);

        }

        document.querySelectorAll('.mode-button').forEach(button => {
            button.addEventListener('click', () => handleButtonClick(button.id));
            });

    </script>
</body>
</html>
